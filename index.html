<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Моя гра</title>

<!-- ICON -->
<link rel="icon" type="image/png" href="pam_egg_pam_pin.png">

<style>
    body {
        margin: 0;
        font-family: Arial;
        background: #222;
        color: white;
        overflow: hidden;
    }

    #loginScreen, #gameContainer, #shopScene {
        position: absolute;
        inset: 0;
    }

    #loginScreen {
        background: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #gameContainer {
        display: none;
        background: #222;
        text-align: center;
    }

    #shopScene {
        display: none;
        background: #7ecbff;
        text-align: center;
        padding-top: 100px;
        font-size: 40px;
    }

    #logoutBtn {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 16px;
        background: #ff4444;
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 18px;
    }

    #shopBtn {
        position: absolute;
        top: 100px;
        left: 10px;
        padding: 10px 20px;
        font-size: 20px;
        background: #4aa3ff;
        color: white;
        border: none;
        border-radius: 10px;
    }

    #counterBlock {
        position: absolute;
        top: 20px;
        left: 20px;
        font-size: 24px;
    }

    #closeShop {
        padding: 10px 20px;
        font-size: 20px;
        background: #ff6b6b;
        color: white;
        border: none;
        border-radius: 10px;
        margin-top: 40px;
    }
</style>
</head>
<body>

<!-- ------------------ LOGIN ------------------ -->
<div id="loginScreen">
    <h2>Вхід у гру</h2>
    <input type="text" id="nickInput" placeholder="Введи нік" style="font-size:20px; padding:10px;">
    <button id="loginBtn" style="font-size:20px; padding:10px 20px; margin-top:20px;">Увійти</button>
</div>

<!-- ------------------ GAME ------------------ -->
<div id="gameContainer">

    <div id="counterBlock">
        Монети: <span id="coinsVal">0</span><br>
        Кристали: <span id="crystalsVal">0</span>
    </div>

    <button id="logoutBtn">Вийти</button>

    <button id="shopBtn">Магазин</button>

    <h1>Центральне зображення</h1>
    <img id="mainImg" src="pam_egg_pam_pin.png" width="250">
</div>

<!-- ------------------ SHOP ------------------ -->
<div id="shopScene">
    <h1>Магазин (порожній)</h1>
    <button id="closeShop">Назад</button>
</div>

<script>
const SERVER_URL = "https://a9899f91-a853-4bd7-af7b-5ee3862e858c-00-3gmthkd6va98d.janeway.replit.dev";

let currentNick = null;
let coins = 0;
let crystals = 0;

// ---------------- LOGIN ----------------
document.getElementById("loginBtn").onclick = async () => {
    const nick = document.getElementById("nickInput").value.trim();
    if (!nick) return alert("Введи нік!");

    currentNick = nick;

    let res = await fetch(SERVER_URL + "/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            nick: nick,
            coins: coins,
            crystals: crystals
        })
    });

    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("gameContainer").style.display = "block";

    // завантаження значень з сервера неможливе (нема ендпоінта)
    // тому просто беремо локальні
};

// ---------------- MAIN CLICK ----------------
document.getElementById("mainImg").onclick = async () => {
    coins++;
    document.getElementById("coinsVal").innerText = coins;

    await saveToServer();
};

// ---------------- SAVE FUNCTION ----------------
async function saveToServer() {
    if (!currentNick) return;

    await fetch(SERVER_URL + "/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            nick: currentNick,
            coins: coins,
            crystals: crystals
        })
    });
}

// ---------------- LOGOUT ----------------
document.getElementById("logoutBtn").onclick = () => {
    currentNick = null;
    coins = 0;
    crystals = 0;

    document.getElementById("coinsVal").innerText = 0;
    document.getElementById("crystalsVal").innerText = 0;

    document.getElementById("gameContainer").style.display = "none";
    document.getElementById("loginScreen").style.display = "flex";
};

// ---------------- SHOP OPEN ----------------
document.getElementById("shopBtn").onclick = () => {
    document.getElementById("gameContainer").style.display = "none";
    document.getElementById("shopScene").style.display = "block";
};

// ---------------- SHOP CLOSE ----------------
document.getElementById("closeShop").onclick = () => {
    document.getElementById("shopScene").style.display = "none";
    document.getElementById("gameContainer").style.display = "block";
};
</script>

</body>
</html>
